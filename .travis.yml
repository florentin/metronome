env:
  global:
    - COMMIT=${TRAVIS_COMMIT::8}
    - REPO={TRAVIS_REPO_SLUG}
    - secure: A03mrmolcILbSRFp1iqF2BLVasx2c990uxUVGEq+sOFNUKBun8VOrmeFjHzMmd19IWL1sjslsaC4s92+1uNbMKLckufoYXaf342Zse1/BwS78StHH6CwNJ4x0/uckcIUavRKwLWXsy0KfsCvfdwNr5/GO33xLKSt10ZI3w4Cyw7iSx+5k2hk/lpkRbtmheWsm0OenHfvgQeGRZd8l411Y7RQk4dFcOLhtYp3BfwiLK8wWITswzRhxWMk0t2fkNMObHcexPtNaUspLbigavsAFTQ6qK4wmw5ur4e+duT3s0IEqxVCQoP/JXnI7q5JKfE8XvGPO8LildAzXYbrfPoY0jrX2soxbdQ8BM6jTP/zyjp+PinR5JZvqfpS8cY+Z9qqytLyfAWQgfzZcO6PAuHZGU0uaAHMfwDycDtB1euW6KM4lJNiR9cm2CiX+SJt2lGvJw3v/s9TA5brTFY/q48yhmTCva2hCJK1ztxsvBe8ayD/eq+dPJhYYGggsVyX1F7yzdT301PfZi1aDmgDE7yZ1hZX75x6/yJO3Fe5MvYAOGbUohsmCHNWJcky9V8yrX0ZOixNg6WUhq2McHULoMIymNaYJng8JlquWicasx/BLZpp/++64iox5UpR6WC8Xt03DYKGz4iWH/74jlhdCUiv0XqRwsk44ISt9S76JnpVzhw=
    - secure: EJ6EnWGUlCEQedr4j5QmiIxW9iuzHzRVs9NQQSMQ6HOaiCeJhupkFEzCqdPRk8MERjjlKpfq4XUXa+e02GyZeKg9cvYPZ/aKxtn9eiIPEEyHdeXUHM44tEJhADDLVLV05o6353HJllZJH252wawfcEypVmw9QgjOoWu3Bc5MD2GVi0R6K99JB/3IrRWS7dYV/I1OXufEHme9UCtX8tyafVL65WgXVBLUrQRLZqZr8nWMeABk+VZ7lJqTe/CE324gMYfSdoQln8QDN808SmMIoLn3vA3EpicnZ+zdDrnxXH7cOzzBfA5B1aWUU21XS9Do/IF/NHfJuRPaYcCtbiMNeZ9rWofKBcIlVKwqMvNhTsDlJl7PPw4Iit7CU+T7S4gYwfEEYfalroUY5eqoGTuUy3HVIym3utmAcy8DfmnmE/ejo28fLJTXj9AOjiwMRbTN4ZZvTKfZO8At7sQzfYKDuzEWp2NVR+BNH0oALbwl2cp8KD+BbVyR2Uqk76kpYyfIhuXpSwiFOkSlT9ZJY/k0IlG403w7CWxXQdZ77fkNrHILDT3R3S9Nvl6wSKKjFUsCuklqShMeC7mNxmni9ZVzpJiCYyWSOJVrPq9DLnadQlrCf4PTWfuOOgUhArUmgzbwEfl/Y5b6r2KBsnEyTXn6NOT80R4eK0uF5q4PisGRy4c=
script:
  - export BRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)
  - export TAG=$(if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo BRANCH; fi)
  - echo "TRAVIS_BRANCH=$TRAVIS_BRANCH, PR=$PR, BRANCH=$BRANCH, TAG=$TRAVIS_TAG, REPO=$REPO"
  - docker build -t $REPO:$TAG -f Dockerfile .
after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
  - docker push $REPO
